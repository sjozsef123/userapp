<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough" >

<h:head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" />
<title>Publication</title>


<script>

	function change(selected) {

		document.getElementById('form:publicationType').value = selected;
	}
	
	function add(type) {
		console.log('adding');
		switch(type) {
		
		case 'book':
				document.getElementById('form:addBook').click();
			break;
		case 'magazine':
				document.getElementById('form:addMagazine').click();
			break;
		case 'newspaper':
				document.getElementById('form:addNewspaper').click();
			break;
		}
		
		
		
	}
	
	function clearForm() {
		
		var form = document.forms['form'];
		
		for( var i=0; i &lt; form.length; i++) {
			switch(form[i].type) {
			
				case 'text':
					form[i].value = '';
					break;			
				case 'radio':
					form[i].checked = false;
					break;
				case 'checkbox':
					form[i].checked = false;
					break;
			}
		}
	}
	
	function clearPubPanel(panel) {
		
		var boxes = panel[1].children[0].children;
		
		for(var i=0; i &lt; boxes.length; i++) {
			boxes[i].children[0].children[0].checked = false;
		}
	}
	
	function editPublication(a) {
	
		var publication = a;
		console.log(publication);
	}
	
</script>

<h:panelGroup id="magazineScript">
					<script>
					
						function editMagazine(data) {
							switch(data.status) {
							
							case 'begin':
// 								console.log('begin');
// 								console.log('#{publicationmanagedbean.magazine.title}');
								break;
							case 'complete':
// 								console.log('complete');
// 								console.log('#{publicationmanagedbean.magazine.title}');
								break;
							case 'success':
// 								console.log('success');
								
								document.getElementById('formTitle').innerHTML="Edit Magazine to...";
								
								fillMagazineFields();

								document.getElementById('form:publicationType:1').click();
								
								setTimeout(function(){ fillMagazinePanel(); }, 50);
								
								break;
							}
						}
						
						function fillMagazineFields() {
							
							console.log('#{publicationmanagedbean.magazine.title}');
							document.getElementById('#{title.clientId}').value='#{publicationmanagedbean.magazine.title}'; 
							document.getElementById('#{stock.clientId}').value='#{publicationmanagedbean.magazine.nrOfCopies}';
							document.getElementById('#{publisher.clientId}').value='#{publicationmanagedbean.magazine.publisher}';
							
						}
						
						function fillMagazinePanel() {
							
// 							console.log('fill magazine panel');
							document.getElementById('#{magazineYear.clientId}').value='#{publicationmanagedbean.magazine.getReleaseYear()}';
							document.getElementById('#{magazineMonth.clientId}').value='#{publicationmanagedbean.magazine.getReleaseMonth()}';
							console.log('itt');
							console.log('#{publicationmanagedbean.magazine.mAuthors[0].name}');
							
						}
						
					</script>
					
</h:panelGroup>
<h:panelGroup id="bookScript">
					<script>
						
							function editBook(data) {
								
								switch(data.status) {
								
								case 'begin':
// 									console.log('begin');
// 									console.log('#{publicationmanagedbean.book.title}');
									break;
								case 'complete':
// 									console.log('complete');
// 									console.log('#{publicationmanagedbean.book.title}');
									break;
								case 'success':
// 									console.log('success');

									document.getElementById('formTitle').innerHTML="Edit Book to...";
									
									fillBookFields();

									document.getElementById('form:publicationType:0').click();
								
									setTimeout(function(){ fillBookPanel(); }, 50);
								}
							}
							
							function fillBookFields() {
								
								console.log('#{publicationmanagedbean.book.title}');
								document.getElementById('#{title.clientId}').value='#{publicationmanagedbean.book.title}'; 
								document.getElementById('#{stock.clientId}').value='#{publicationmanagedbean.book.nrOfCopies}';
								document.getElementById('#{publisher.clientId}').value='#{publicationmanagedbean.book.publisher}';
								
							}
							
							function fillBookPanel() {
							
								console.log('fill book panel');
								document.getElementById('#{bookYear.clientId}').value='#{publicationmanagedbean.book.getReleaseYear()}';
								
							}
					</script>
</h:panelGroup>

<h:panelGroup id="newspaperScript">
					<script>
					
						function editNewspaper(data) {
							switch(data.status) {
							
							case 'begin':
// 								console.log('begin');
// 								console.log('#{publicationmanagedbean.newspaper.title}');
								break;
							case 'complete':
// 								console.log('complete');
// 								console.log('#{publicationmanagedbean.newspaper.title}');
								break;
							case 'success':
// 								console.log('success');
								
								document.getElementById('formTitle').innerHTML="Edit Newspaper to...";
								
								fillNewspaperFields();

								document.getElementById('form:publicationType:2').click();
								
								setTimeout(function(){ fillNewspaperPanel(); }, 50);
								
								break;
							}
						}
						
						function fillNewspaperFields() {
							
							console.log('#{publicationmanagedbean.newspaper.title}');
							document.getElementById('#{title.clientId}').value='#{publicationmanagedbean.newspaper.title}'; 
							document.getElementById('#{stock.clientId}').value='#{publicationmanagedbean.newspaper.nrOfCopies}';
							document.getElementById('#{publisher.clientId}').value='#{publicationmanagedbean.newspaper.publisher}';
							
						}
						
						function fillNewspaperPanel() {
							
							console.log('fill newspaper panel');
							document.getElementById('#{newspaperYear.clientId}').value='#{publicationmanagedbean.newspaper.getReleaseYear()}';
							document.getElementById('#{newspaperMonth.clientId}').value='#{publicationmanagedbean.newspaper.getReleaseMonth()}';
							document.getElementById('#{newspaperDay.clientId}').value='#{publicationmanagedbean.newspaper.getReleaseDay()}';
							
						}
						
					</script>
					
</h:panelGroup>

</h:head>
<h:body onload="#{publicationmanagedbean.onLoad()}">

	<h2>Publication list</h2>

	<div style="float: left; clear: both; margin-right: 50px;">

		<h4>Filter by name:</h4>
		<h:form>
			<p>
				<h:inputText value="#{publicationmanagedbean.filter}">
				</h:inputText>
				<br />
				<h:commandButton value="Search" render="publicationList" />
				<h:commandButton value="Clear"
					action="#{publicationmanagedbean.clearFilter()}"
					render="publicationList" />

			</p>
		</h:form>
		<h:form id="tableForm" rendered="#{not empty publicationmanagedbean.publicationList}">
			<h:dataTable id="publicationList"
				value="#{publicationmanagedbean.publicationList}" var="item">
				<h:column>
					<f:facet name="header">Title</f:facet>#{item.title}</h:column>
				<h:column>
					<f:facet name="header">Type</f:facet>#{publicationmanagedbean.getType(item)}</h:column>

				<h:column>
					
					<h:commandButton id="editBook" value="editB" 
						rendered="#{publicationmanagedbean.getType(item) eq 'Book'}" >
						<f:actionListener binding="#{publicationmanagedbean.createBook(item.id)}"/>
						<f:ajax event="click" listener="#{publicationmanagedbean.castItem(item)}" onevent="editBook" render="bookScript form:savePanel"/>
						
					</h:commandButton>
					
					<h:commandButton id="editMagazine" value="editM" 
						rendered="#{publicationmanagedbean.getType(item) eq 'Magazine'}">
						<f:ajax event="click" listener="#{publicationmanagedbean.castItem(item)}" onevent="editMagazine" render="magazineScript form:savePanel"/>
					</h:commandButton>
					
					<h:commandButton id="editNewspaper" value="editN" 
						rendered="#{publicationmanagedbean.getType(item) eq 'Newspaper'}">
						<f:ajax event="click" listener="#{publicationmanagedbean.castItem(item)}" onevent="editNewspaper" render="newspaperScript form:savePanel"/>
					</h:commandButton>
					
				</h:column>
				<h:column>
					<h:commandButton value="delete"
						action="#{publicationmanagedbean.deletePublication(item)}"
						onclick="if(!confirm('Do you really wanna do that?')) return false" />
				</h:column>
				<h:column>
					<h:commandButton value="details" />
				</h:column>

			</h:dataTable>
		</h:form>

		<h:panelGroup
			rendered="#{empty publicationmanagedbean.publicationList}">
			<p>No Publication!.</p>
		</h:panelGroup>
	</div>

	<div style="float: left; clear: right; margin-right: 50px;">
		<h:form id="form" >
			<h2 id="formTitle">Add publication</h2>
			<p>
				Title:
				<h:inputText id="publicationTitle" binding="#{title}" 
					required="true" />
			</p>

			<p>
				Stock:
				<h:inputText id="publicationStock" binding="#{stock}"
					required="true" />
			</p>

			<p>
				Publisher:
				<h:inputText id="publicationPublisher" binding="#{publisher}"
					required="true" />
			</p>




			

				<h:selectOneRadio id="publicationType" onchange="change(this.value)"
					binding="#{selectedPublicationType}" 
					required="true">
					<f:selectItem id="bookRadio" itemValue="book" itemLabel="Book" />
					<f:selectItem id="magazineRadio" itemValue="magazine" itemLabel="Magazine" />
					<f:selectItem id="newspaperRadio" itemValue="newspaper"	itemLabel="Newspaper" />
					<f:ajax render="panels"/>

				</h:selectOneRadio>
<h:panelGroup id="panels">
				<h:panelGroup id="bookPanel" rendered="#{selectedPublicationType.value == 'book'}">
					<p>
						Release date:
						<h:inputText id="bookYear" binding="#{bookYear}" a:placeholder="Year" style="width: 50px;" />
					</p>
					<h:selectManyCheckbox id="bookAuthorList" layout="pageDirection"
						binding="#{selectedBookAuthors}">
						<f:selectItems value="#{authorManagedBean.getAllAuthor()}"
							var="bAuthor" itemLabel="#{bAuthor.name}"
							itemValue="#{bAuthor.id},#{bAuthor.name}" />
					</h:selectManyCheckbox>
					<h:commandButton id="addBook"						
						style="display: none;"  >
						<f:actionListener binding="#{publicationmanagedbean.createBook()}"/>
						<f:actionListener binding="#{publicationmanagedbean.setBookTitle(title.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setBookStock(stock.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setBookPublisher(publisher.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setBookReleaseDate(bookYear.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setBookAuthors(selectedBookAuthors.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.addBook()}"/>
					</h:commandButton>
				</h:panelGroup>

				<h:panelGroup id="magazinePanel" rendered="#{selectedPublicationType.value == 'magazine'}">
				
					<p>
						Release date: <br/>
						<h:inputText id="magazineYear" binding="#{magazineYear}" a:placeholder="Year" style="width: 50px; margin-right: 15px;"
							 />
						<h:inputText id="magazineMonth" binding="#{magazineMonth}" a:placeholder="Month" style="width: 50px;"
							 />
					</p>
					<h:selectManyCheckbox id="magazineAuthorList"
						layout="pageDirection" binding="#{selectedMagazineAuthors}">
						<f:selectItems value="#{authorManagedBean.getAllAuthor()}"
							var="mAuthor" itemLabel="#{mAuthor.name}"
							itemValue="#{mAuthor.id},#{mAuthor.name}" />
					</h:selectManyCheckbox>
					<h:commandButton id="addMagazine"
						style="display: none;" >
						<f:actionListener binding="#{publicationmanagedbean.createMagazine()}"/>
						<f:actionListener binding="#{publicationmanagedbean.setMagazineTitle(title.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setMagazineStock(stock.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setMagazinePublisher(publisher.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setMagazineReleaseDate(magazineYear.value, magazineMonth.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setMagazineAuthors(selectedMagazineAuthors.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.addMagazine()}"/>
					</h:commandButton>
				</h:panelGroup>

				<h:panelGroup id="newspaperPanel" rendered="#{selectedPublicationType.value == 'newspaper'}">
				
					<p>
						Release date: <br/>
						<h:inputText id="newspaperYear" binding="#{newspaperYear}" a:placeholder="Year" style="width: 50px; margin-right: 15px;"
							 />
						<h:inputText id="newspaperMonth" binding="#{newspaperMonth}" a:placeholder="Month" style="width: 50px; margin-right: 15px;"
							 />
						<h:inputText id="newspaperDay" binding="#{newspaperDay}" a:placeholder="Day" style="width: 50px;"
							 />
					</p>
					<h:selectManyCheckbox id="newspaperArticleList"
						layout="pageDirection" binding="#{selectedNewspaperArticles}">
						<f:selectItems value="#{articleManagedBean.getAllArticles()}"
							var="article" itemLabel="#{article.title}"
							itemValue="#{article.id},#{article.title}" /> 
					</h:selectManyCheckbox>
					<h:commandButton id="addNewspaper"
						style="display: none;" >
						<f:actionListener binding="#{publicationmanagedbean.createNewspaper()}"/>
						<f:actionListener binding="#{publicationmanagedbean.setNewspaperTitle(title.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setNewspaperStock(stock.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setNewspaperPublisher(publisher.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setNewspaperReleaseDate(newspaperYear.value, newspaperMonth.value, newspaperDay.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setNewspaperArticles(selectedNewspaperArticles.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.addNewspaper()}"/>
					</h:commandButton>
				</h:panelGroup>

</h:panelGroup>			

			<p>
				<h:panelGroup id="savePanel">
					<h:commandButton id="add" value="Add"
						onclick="add(document.getElementById('form:publicationType').value);" />
						
					<h:commandButton id="saveBook" value="Save book" rendered="#{!(publicationmanagedbean.book == null)}"
						 >
						
						<f:actionListener binding="#{publicationmanagedbean.setBookTitle(title.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setBookStock(stock.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setBookPublisher(publisher.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setBookReleaseDate(bookYear.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.setBookAuthors(selectedBookAuthors.value)}"/>
						<f:actionListener binding="#{publicationmanagedbean.finalizeBookEdit()}"/>
					</h:commandButton>
					<h:commandButton id="saveMagazine" value="Save magazine" rendered="#{!(publicationmanagedbean.magazine == null)}"
						onclick="add(document.getElementById('form:publicationType').value);" />
					<h:commandButton id="saveNewspaper" value="Save newspaper" rendered="#{!(publicationmanagedbean.newspaper == null)}"
						onclick="add(document.getElementById('form:publicationType').value);" />
				</h:panelGroup>
			</p>

		</h:form>
	</div>

</h:body>
</html>