<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough" 
	xmlns:p="http://primefaces.org/ui">

<h:head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" />
<f:metadata>
	<f:viewAction action="#{loginmanagedbean.isLoggedIn()}" />
</f:metadata>
<title>Publication</title>


</h:head>
<h:body onload="#{publicationmanagedbean.onLoad()}">

	<h:panelGrid id="panel" columns="4" border="0" cellpadding="10"
		cellspacing="1">		
	<h:column rendered="#{loginmanagedbean.isAdmin() eq null}">
		<ui:include src="/includes/navigation.xhtml" style="float: left; clear: both;" />
	</h:column>
	
	<h:column>
	
	<h2>#{msg['web.publication.header.publications']}</h2>
		
		<h:form id="tableForm">
		<p:dataTable id="publicationTable" var="item" value="#{publicationmanagedbean.publicationList}"
					emptyMessage="No publications found!" editable="true"
					>
			<p:ajax event="rowEdit" listener="#{dtEditView.onRowEdit}" update="tableForm:publicationTable" />
       		<p:ajax event="rowEditCancel" listener="#{dtEditView.onRowCancel}" update="tableForm:publicationTable" />			
			

			<p:column>
				<f:facet name="header">
					<p:outputLabel value="#{msg['web.title']}" /> <br/>
					<p:inputText id="titleFilter" value="#{publicationmanagedbean.publicationFilter.title}" >
						<p:ajax event="keyup" update="tableForm:publicationTable" process="titleFilter"/>
					</p:inputText>
				</f:facet>
					<h:outputText value="#{item.title}" />
			</p:column>
			
			<p:column>
				<f:facet name="header">
					<p:selectCheckboxMenu label="#{msg['web.type']}" value="#{publicationmanagedbean.publicationFilter.type}" >
						<f:selectItem itemLabel="Book" itemValue="Book"/>
						<f:selectItem itemLabel="Magazine" itemValue="Magazine"/>
						<f:selectItem itemLabel="Newspaper" itemValue="Newspaper"/>
						<p:ajax event="change" update="tableForm:publicationTable" />
					</p:selectCheckboxMenu>
				</f:facet>
					<h:outputText value="#{publicationmanagedbean.getType(item)}" />
			</p:column>
			
			<p:column>
				<f:facet name="header">
					<p:outputLabel value="#{msg['web.onStock']}" /> <br/>
					
					<p:inputText id="minStock" value="#{publicationmanagedbean.publicationFilter.minStock}" 
									placeholder="min" style="width: 70px;" >
						<p:ajax event="keyup" update="tableForm:publicationTable" process="minStock maxStock" />
					</p:inputText>
					<p:outputLabel value=" - " />
					<p:inputText id="maxStock" value="#{publicationmanagedbean.publicationFilter.maxStock}" 
									placeholder="max" style="width: 75px;" >
						<p:ajax event="keyup" update="tableForm:publicationTable" process="minStock maxStock" />
					</p:inputText>
				</f:facet>
				<h:outputText value="#{item.copiesLeft}" />
			</p:column>
			
			<p:column>
				<f:facet name="header">
					<p:outputLabel value="#{msg['web.publisher']}" /> <br/>
					<p:inputText id="publicationFilter" value="#{publicationmanagedbean.publicationFilter.publisher}" >
						<p:ajax event="keyup" update="tableForm:publicationTable" process="publicationFilter" />
					</p:inputText>
				</f:facet>
				<h:outputText value="#{item.publisher}" />
			</p:column>
			
			<p:column>
				<f:facet name="header">
					<p:outputLabel value="#{msg['web.release']}" /> <br/>
					<p:inputText id="afterYear" value="#{publicationmanagedbean.publicationFilter.releasedAfter}" placeholder="after" style="width: 50px;" >
						<p:ajax event="keyup" update="tableForm:publicationTable" process="afterYear"/>
					</p:inputText>
					<p:outputLabel value=" - " />
					<p:inputText id="beforeYear" value="#{publicationmanagedbean.publicationFilter.releasedBefore}" placeholder="before" style="width: 50px;" >
						<p:ajax event="keyup" update="tableForm:publicationTable" process="beforeYear" />
					</p:inputText>
				</f:facet>
				<h:outputText value="#{item.getReleaseYear()}" />
				<h:outputText value=" / #{item.getReleaseMonth()}"
					rendered="#{publicationmanagedbean.getType(item) eq 'Magazine' or publicationmanagedbean.getType(item) eq 'Newspaper'}" />
				<h:outputText value=" / #{item.getReleaseMonth()}"
					rendered="#{publicationmanagedbean.getType(item) eq 'Newspaper'}" />
			</p:column>
			
			<p:column style="width:50px">
				<f:facet name="header">
					<p:commandButton value="X" >
						<p:ajax listener="#{publicationmanagedbean.clearFilter()}" update="@form"/>
					</p:commandButton>
				</f:facet>
				<p:rowEditor />
			</p:column>
			
			<p:column style="width: 16px;">
			
				<h:panelGroup rendered="#{publicationmanagedbean.getType(item) == 'Book'}">
					<p:commandLink oncomplete="PF('bAuthorList').show()" 
						styleClass="ui-icon ui-icon-search" style="float:left;margin-right:10px"/>
						
					<p:dialog header="Authors" hideEffect="explode" resizable="false" widgetVar="bAuthorList" modal="true" showEffect="blind" stlye="display: none;">
						<p:dataList value="#{item.bAuthors}" var="bAuthor">
							<h:outputText value="#{bAuthor.name}" style="display:inline-block"/>
						</p:dataList>
					</p:dialog>			
				</h:panelGroup>
				
				<h:panelGroup rendered="#{publicationmanagedbean.getType(item) == 'Magazine'}">
					<p:commandLink oncomplete="PF('mAuthorList').show()" 
						styleClass="ui-icon ui-icon-search" style="float:left;margin-right:10px"/>
					
					<p:dialog header="Authors" hideEffect="explode" resizable="false" widgetVar="mAuthorList" modal="true" showEffect="blind">
						<p:dataList value="#{item.mAuthors}" var="mAuthor">
							<h:outputText value="#{mAuthor.name}" style="display:inline-block"/>
						</p:dataList>
					</p:dialog>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{publicationmanagedbean.getType(item) == 'Newspaper'}">
				<p:commandLink oncomplete="PF('articleList').show()" 
					styleClass="ui-icon ui-icon-search" style="float:left;margin-right:10px"/>
					
					<p:dialog header="Articles" hideEffect="explode" resizable="false" widgetVar="articleList" modal="true" showEffect="blind" >
						<p:dataList value="#{item.articles}" var="article">
							<h:outputText value="#{article.title}" style="display:inline-block"/>
						</p:dataList>
					</p:dialog>
				</h:panelGroup>
				
					
			</p:column>
			
		</p:dataTable>
			
				
		</h:form>
	</h:column>

	
	</h:panelGrid>

</h:body>
	<ui:include src="/includes/footer.xhtml" />	
</html>