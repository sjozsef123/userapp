<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" />
<f:metadata>
	<f:viewAction action="#{loginmanagedbean.isAdmin()}" />
</f:metadata>
<title>#{msg['web.borrowing.title']}</title>
</head>
<body>

	<h:panelGrid id="panel" columns="4" border="1" cellpadding="10"
		cellspacing="1">		
		<h:column>
			<ui:include src="/includes/navigation.xhtml" />
		</h:column>
		
		<h:column>
			<h2>#{msg['web.borrowing.header.users']}</h2>
			<h:form rendered="#{not empty usermanagedbean.allUsers}">
				<h:dataTable value="#{usermanagedbean.allUsers}" var="item">
					<h:column>
						<f:facet name="header">#{msg['web.name']}</f:facet>#{item.username}</h:column>
					<h:column>
						<f:facet name="header">#{msg['web.loyaltyindex']}</f:facet>#{item.loyaltyIndex}</h:column>
					<h:column>

						<h:column>
							<h:commandButton value="#{msg['web.select']}"
								action="#{borrowingmanagedbean.selectUser(item)}" />
						</h:column>
					</h:column>
				</h:dataTable>
			</h:form>

			<h3>#{msg['web.borrowing.header.filterusers']}</h3>
			<h:form>
				<p>
					<h:inputText value="#{usermanagedbean.searchName}">
					</h:inputText>
					<h:commandButton value="#{msg['web.search']}" outcome="user" />
				</p>
			</h:form>
		</h:column>

		<h:column>
			<h2>#{msg['web.borrowing.header.borrowpublication']}</h2>
			<h:form
				rendered="#{not empty publicationmanagedbean.publicationList}">
				<h:dataTable id="publicationList"
					value="#{publicationmanagedbean.publicationList}" var="item">
					<h:column>
						<f:facet name="header">#{msg['web.title']}</f:facet>#{item.title}</h:column>
					<h:column>
						<f:facet name="header">Type</f:facet>#{publicationmanagedbean.getType(item)}</h:column>
					<h:column>
						<f:facet name="header">Copies Left</f:facet>#{item.copiesLeft}</h:column>

					<h:column>
						<h:commandButton value="#{msg['web.select']}"
							action="#{borrowingmanagedbean.selectPublication(item)}"/>
					</h:column>
				</h:dataTable>
			</h:form>

			<h4>Filter by name:</h4>
			<h:form>
				<p>
					<h:inputText value="#{publicationmanagedbean.filter}">
					</h:inputText>
					<br />
					<h:commandButton value="Search" render="publicationList" />
					<h:commandButton value="Clear"
						action="#{publicationmanagedbean.clearFilter()}"
						render="publicationList" />
				</p>
			</h:form>
			
			<h:form rendered="#{borrowingmanagedbean.borrowingIdCompleted}">
				<p>
					<h:column>
						<h:commandButton value="#{msg['web.borrow']}"
							action="#{borrowingmanagedbean.borrowBorrowing()}" />
					</h:column>
				</p>
			</h:form>
		</h:column>

		<h:column rendered="#{not empty borrowingmanagedbean.user.borrowing}">
			<h2> #{msg['web.borrowing.header.returnpublication']}</h2>
			<h:form>
				<h:dataTable value="#{borrowingmanagedbean.user.borrowing}"
					var="item">
					<h:column>
						<f:facet name="header">#{msg['web.title']}</f:facet>#{item.publication.title}</h:column>
					<h:column>
						<f:facet name="header">#{msg['web.publisher']}</f:facet>#{item.publication.publisher}</h:column>

					<h:column>
						<h:commandButton value="#{msg['web.select']}"
							action="#{borrowingmanagedbean.selectPublication(item.publication)}" />
					</h:column>
				</h:dataTable>
			</h:form>

			<h:form rendered="#{borrowingmanagedbean.borrowingIdCompleted}">
				<p>
					<h:column>
						<h:commandButton value="#{msg['web.return']}"
							action="#{borrowingmanagedbean.returnBorrowing()}" />
					</h:column>
				</p>
			</h:form>
		</h:column>

	</h:panelGrid>	

	<ui:include src="/includes/footer.xhtml" />
</body>
</html>