<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" />
	<f:metadata>
		<f:viewAction action="#{loginmanagedbean.isAdmin()}" />
	</f:metadata>
	<title>#{msg['web.borrowing.title']}</title>
</h:head>
<body>
			<ui:include src="/includes/navigation.xhtml" />
	<p:messages id="messages" showDetail="false" autoUpdate="true"
		closable="true" />
	<h:panelGrid id="panel" columns="3" border="0" cellpadding="5"
		cellspacing="1">

	


		<h:column>
			<p:panel header="#{msg['web.borrowing.header.users']}">
				<p:spacer height="10px;" />
				#{publicationmanagedbean.init()}
				#{usermanagedbean.init()}
				<h:form id="form1">
					<p:panel header="#{msg['web.search']}">
						<h:inputText id="namefilter" value="#{usermanagedbean.searchName}">
							<p:ajax event="keyup" update="form1:userTable"
								process="namefilter" listener="#{usermanagedbean.init()}" />
						</h:inputText>
					</p:panel>
					<p:defaultCommand target="dummy" />
					<p:commandButton id="dummy" process="@none" global="false"
						style="display:none;" />

					<p:dataTable id="userTable" value="#{usermanagedbean.allUsers}"
						var="u" widgetVar="50" selectionMode="single"
						selection="#{borrowingmanagedbean.user}" rowKey="#{u.id}">

						<p:ajax event="rowSelect"
							listener="#{borrowingmanagedbean.selectUser()}" 
							update = "form2,form3"/>

						<p:column>
							<f:facet name="header">
								<h:outputText value="#{msg['web.user.name']}" />
							</f:facet>
							<h:outputText value="#{u.username}" />
						</p:column>

						<p:column>
							<f:facet name="header">
								<h:outputText value="#{msg['web.user.loyalty']}" />
							</f:facet>
							<h:outputText value="#{u.loyaltyIndex}" style="width:110px" />
						</p:column>
					</p:dataTable>
				</h:form>
			</p:panel>
		</h:column>

		<h:column>
			<p:panel header="#{msg['web.borrowing.header.borrowpublication']}">
				<p:spacer height="10px;" />
				<h:form id="form2">
					<p:panel header="#{msg['web.search']}">						
						<p:inputText id="titleFilter"
							value="#{publicationmanagedbean.publicationFilter.title}">
							<p:ajax event="keyup" update="form2:pubTable"
								process="titleFilter"
								listener="#{publicationmanagedbean.init()}" />
						</p:inputText>
					</p:panel>
					<p:defaultCommand target="dummy" />
					<p:commandButton id="dummy" process="@none" global="false"
						style="display:none;" />

					<p:dataTable id="pubTable"
						value="#{publicationmanagedbean.publicationList}" var="p"
						widgetVar="51" selectionMode="single"
						selection="#{borrowingmanagedbean.publication}" rowKey="#{p.id}">

						<p:ajax event="rowSelect"
							listener="#{borrowingmanagedbean.selectPublication()}" 
							update = "form2"/>

						<p:column>
							<f:facet name="header">
								<h:outputText value="#{msg['web.title']}" />
							</f:facet>
							<h:outputText value="#{p.title}" />
						</p:column>

						<p:column>
							<f:facet name="header">
								<h:outputText value="#{msg['web.type']}" />
							</f:facet>
							<h:outputText value="#{publicationmanagedbean.getType(p)}" />
						</p:column>

						<p:column>
							<f:facet name="header">
								<h:outputText value="#{msg['web.publication.copiesleft']}" />
							</f:facet>
							<h:outputText value="#{p.copiesLeft}" style="width:110px" />
						</p:column>
					</p:dataTable>

					<h:form rendered="#{borrowingmanagedbean.borrowingIdCompleted}"> 
						<p>
							<h:column>
								<p:commandButton value="#{msg['web.borrow']}" 
									action="#{borrowingmanagedbean.borrowBorrowing()}"
									update="@all" />
							</h:column>
						</p>
					</h:form>
				</h:form>
			</p:panel>
		</h:column>

		<h:column>
			<p:panel header="#{msg['web.borrowing.header.returnpublication']}">
				<p:spacer height="10px;" />
				<h:form id="form3">
					<p:defaultCommand target="dummy" />
					<p:commandButton id="dummy" process="@none" global="false"
						style="display:none;" />

					<p:dataTable id="retPubTable"
						value="#{borrowingmanagedbean.user.borrowing}" var="b"
						widgetVar="52" selectionMode="single"
						selection="#{borrowingmanagedbean.borrowing}"
						rowKey="#{b.publication.id}">

						<p:ajax event="rowSelect"
							listener="#{borrowingmanagedbean.selectReturnPublication()}" 
							update = "form3"/>

						<p:column>
							<f:facet name="header">
								<h:outputText value="#{msg['web.title']}" />
							</f:facet>
							<h:outputText value="#{b.publication.title}" />
						</p:column>

						<p:column>
							<f:facet name="header">
								<h:outputText value="#{msg['web.type']}" />
							</f:facet>
							<h:outputText value="#{publicationmanagedbean.getType(b.publication)}" />
						</p:column>

						<p:column>
							<f:facet name="header"> 
								<h:outputText value="#{msg['web.publisher']}" />
							</f:facet>
							<h:outputText value="#{b.publication.publisher}" />
						</p:column>
					</p:dataTable>

					<h:form rendered="#{borrowingmanagedbean.returnIdCompleted}"> 
						<p>
							<h:column>
								<p:commandButton value="#{msg['web.return']}"
									action="#{borrowingmanagedbean.returnBorrowing()}" 
									update="@all"
								/>
							</h:column>
						</p>
					</h:form>
				</h:form>
			</p:panel>
		</h:column>
	</h:panelGrid>
<ui:include src="/includes/footer.xhtml" />

</body>
</html>